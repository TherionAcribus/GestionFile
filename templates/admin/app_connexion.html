<div class="connection-card">
    <div class="connection-card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">Connexions actives</h6>
        <button class="btn btn-outline-primary btn-sm" id="refreshButton">Rafraîchir</button>
    </div>

    <div class="connection-card-body">
        <label for="namespaceSelect" class="connection-label">Namespaces</label>
        <select id="namespaceSelect" name="namespaces[]" multiple="multiple" class="connection-select">
            {% for namespace in namespaces %}
                <option value="{{ namespace }}">{{ namespace }}</option>
            {% endfor %}
        </select>
    </div>

    <div id="connectionList" class="connection-list"></div>
</div>

<script>
$(document).ready(function() {
    // Initialisation de Select2
    $('#namespaceSelect').select2();
    
    // Fonction pour envoyer la requête HTMX
    function displayListConnections() {
        var selectedNamespaces = $('#namespaceSelect').val() || [];
        htmx.ajax('POST', '/admin/app/get_connections', {
            target: '#connectionList',
            swap: 'innerHTML',
            values: {
                'namespaces[]': selectedNamespaces
            }
        });
    }

    // Lorsque la sélection change
    $('#namespaceSelect').on('change', function() {
        displayListConnections();
    });

    // Lorsqu'on clique sur le bouton Rafraîchir
    $('#refreshButton').on('click', function() {
        displayListConnections();
    });

    // Envoyer la requête automatiquement lors du chargement de la page
    displayListConnections();
});
</script>