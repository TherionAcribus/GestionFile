{% macro button(key, check) %}
<button
    class="btn"
    hx-post="/admin/update_input"
    hx-target="#invisible"
    hx-vals='js:{"key": "{{ key }}", 
            "value": document.getElementById("{{ key }}").value,
            "check": "{{ check }}"}''>
    Enregistrer</button>
{% endmacro %}

{% macro balises_before_call(key) %}
<div>
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{P}')">{P}</span>
    pour le nom de la pharmacie,  
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{N}')">{N}</span>
    pour le numéro du patient, 
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{A}')">{A}</span>
    pour l'activité, 
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{D}')">{D}</span>
    pour la date,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{H}')">{H}</span>
    pour l'heure.
</div>
{% endmacro %}

{% macro balises_for_printer(key) %}
<div>
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '[center][/center]')">Centrer</span>,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '[double][/double]')">Double taille</span>,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '**Texte en gras**')">Gras</span>,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '__Texte souligné__')">Souligné</span>,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '[separator]')">Séparateur</span>
</div>
{% endmacro %}

{% macro balises_after_call(key) %}
<div>
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{P}')">{P}</span>
    pour le nom de la pharmacie,  
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{N}')">{N}</span>
    pour le numéro du patient, 
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{A}')">{M}</span>
    pour le membre de l'équipe, 
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{C}')">{C}</span>
    pour le comptoir,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{D}')">{D}</span>
    pour la date,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{H}')">{H}</span>
    pour l'heure.
</div>
{% endmacro %}


{% macro balises_welcome(key) %}
<div>
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{P}')">{P}</span>
    pour le nom de la pharmacie, 
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{D}')">{D}</span>
    pour la date,
    <span class="variables_calling" onclick="insertPlaceholder('{{ key }}', '{H}')">{H}</span>
    pour l'heure.
</div>
{% endmacro %}


{% macro textarea(key, value, label) %}
<div class="input-field col s12">
    <textarea id="{{ key }}" class="materialize-textarea">{{ value }}</textarea>
    <label for="{{ key }}">{{label}}</label>
</div>
{% endmacro %}


{% macro textbloc_before_call(key, value, label) %}
<div class="row">
    <div class="row">
        {{ textarea(key, value, label) }}
        {{ balises_before_call(key) }}
    </div>
    {{ button(key, "before_call") }}
</div>
{% endmacro %}


{% macro textbloc_for_printer(key, value, label) %}
<div class="row">
    <div class="row">
        {{ textarea(key, value, label) }}
        {{ balises_before_call(key) }}
        {{ balises_for_printer(key) }}
    </div>
    {{ button(key, "before_call") }}
</div>
{% endmacro %}


{% macro textbloc_after_call(key, value, label) %}
<div class="row">
    <div class="row">
        {{ textarea(key, value, label) }}
        {{ balises_after_call(key) }}
    </div>
    {{ button(key, "after_call") }}
</div>
{% endmacro %}

{% macro textbloc_welcome(key, value, label) %}
<div class="row">
    <div class="row">
        {{ textarea(key, value, label) }}
        {{ balises_welcome(key) }}
    </div>
    {{ button(key, "welcome") }}
</div>
{% endmacro %}

<!-- Champs texte pour les entiers -->
{% macro textbloc_int(key, value, label) %}
<div class="row">
    <div class="row">
        {{ textarea(key, value, label) }}
    </div>
    {{ button(key, "int") }}
</div>
{% endmacro %}


{% macro textarea_full(key, value, label) %}
<div class="row">
    <div class="row">
        {{ textarea(key, value, label) }}
    </div>
    {{ button(key) }}
</div>
{% endmacro %}



{% macro switch(key, check, label, label_false, label_true) %}
<div class="switch">
    <span>{{label}} </span>
    <label>
    {{label_false}}
    <input id="{{key}}" 
            type="checkbox"
            {% if check == True %}checked{% endif %}
            hx-post="/admin/update_switch"
            hx-target="#invisible"
            hx-vals='js:{"key": "{{key}}",
                        "value": document.getElementById("{{key}}").checked}'>
    <span class="lever"></span>
    {{label_true}}
    </label>
</div>
{% endmacro %}


{% macro save_restore(table) %}
<h3>Sauvegarde</h3>
<a class='btn' href="{{ url_for(table + '_backup') }}">Sauvegarder les données</a>

<h3>Restauration</h3>
<!-- Button to trigger the modal -->
<a class="btn red modal-trigger" href="#restoreModal">Restaurer les données</a>

<!-- Modal Structure -->
<div id="restoreModal" class="modal">
    <div class="modal-content">
        <h4>Restaurer les données</h4>
        <form id="restoreForm" action="{{ url_for(table + '_restore') }}" method="post" enctype="multipart/form-data">
            <div class="file-field input-field">
                <div class="btn">
                    <span>Choisir un fichier</span>
                    <input type="file" name="file" accept=".json" id="fileInput">
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate" type="text">
                </div>
            </div>
            <div id="fileContent">
                <!-- This div will display the metadata -->
            </div>
            <div class="">Attention, les données existantesé seront définitivement supprimées !</div>
            <button class="btn red" type="submit" id="restoreButton" disabled>Restaurer les données</button>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">Annuler</a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('.modal');
        var instances = M.Modal.init(elems);

        var fileInput = document.getElementById('fileInput');
        var restoreButton = document.getElementById('restoreButton');
        var fileContentDiv = document.getElementById('fileContent');

        fileInput.addEventListener('change', function(event) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var content = e.target.result;
                    try {
                        var jsonContent = JSON.parse(content);
                        var metadata = {
                            "name": jsonContent.name,
                            "type": jsonContent.type,
                            "version": jsonContent.version,
                            "timestamp": jsonContent.timestamp,
                            "comments": jsonContent.comments
                        };
                        var metadataContent = `
                            <div><strong>Name:</strong> ${metadata.name}<br>
                            <strong>Type:</strong> ${metadata.type}<br>
                            <strong>Version:</strong> ${metadata.version}<br>
                            <strong>Timestamp:</strong> ${metadata.timestamp}<br>
                            <strong>Comments:</strong> ${metadata.comments}</div>
                        `;
                        fileContentDiv.innerHTML = metadataContent;
                        restoreButton.disabled = false; // Enable the button
                    } catch (error) {
                        fileContentDiv.innerText = 'Invalid JSON file or missing metadata';
                        restoreButton.disabled = true; // Disable the button in case of error
                    }
                };
                reader.readAsText(file);
            } else {
                fileContentDiv.innerText = '';
                restoreButton.disabled = true; // Disable the button if no file is selected
            }
        });
    });
</script>
{% endmacro %}
